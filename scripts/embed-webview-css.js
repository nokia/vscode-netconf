/**
 * Reads src/xmlNavigator/webview/css/*.css and writes out/xmlNavigator/webviewCss.embed.js
 * so the XML Navigator webview has CSS inlined at build time.
 */
const fs = require('fs');
const path = require('path');

const ROOT = path.resolve(__dirname, '..');
const CSS_DIR = path.join(ROOT, 'src', 'webview', 'css');
const FILES = ['base.css', 'path-bar.css', 'table-view.css', 'element-view.css', 'status-bar.css'];
const OUT_FILE = path.join(ROOT, 'out', 'webviewCss.embed.js');

const parts = [];
for (const file of FILES) {
  const filePath = path.join(CSS_DIR, file);
  try {
    parts.push(fs.readFileSync(filePath, 'utf8'));
  } catch (err) {
    console.warn(`[embed-webview-css] Could not read ${file}:`, err.message);
  }
}
const css = parts.join('\n');
const escaped = css
  .replace(/\\/g, '\\\\')
  .replace(/"/g, '\\"')
  .replace(/\r\n/g, '\\n')
  .replace(/\n/g, '\\n')
  .replace(/\r/g, '\\n');

fs.mkdirSync(path.dirname(OUT_FILE), { recursive: true });
fs.writeFileSync(OUT_FILE, `/* Generated by scripts/embed-webview-css.js - do not edit */\nmodule.exports = "${escaped}";\n`, 'utf8');
console.log('[embed-webview-css] Wrote', OUT_FILE);
